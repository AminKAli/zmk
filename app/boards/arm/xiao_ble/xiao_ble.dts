/*
 * Copyright (c) 2022-2023 Marcin Niestroj
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;
#include "xiao_ble_common.dtsi"
#include <dt-bindings/zmk/matrix_transform.h>

/ {
	model = "Seeed XIAO BLE";
	compatible = "seeed,xiao-ble";

	chosen {
        zephyr,code-partition = &code_partition;
        zephyr,sram = &sram0;
        zephyr,flash = &flash0;
        zmk,kscan = &kscan1;
        zmk,matrix-transform = &transform1;
    };

    kscan0: kscan_direct {
        compatible = "zmk,kscan-gpio-direct";
        wakeup-source;
        input-gpios = <&gpio0 5 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };

    kscan1: kscan_matrix {
        compatible = "zmk,kscan-gpio-matrix";
        wakeup-source;
        diode-direction = "col2row";
        col-gpios = <&gpio0 2 GPIO_ACTIVE_HIGH>,
                    <&gpio0 3 GPIO_ACTIVE_HIGH>,
                    <&gpio0 28 GPIO_ACTIVE_HIGH>,
                    <&gpio0 29 GPIO_ACTIVE_HIGH>,
                    <&gpio0 4 GPIO_ACTIVE_HIGH>,
                    <&gpio0 5 GPIO_ACTIVE_HIGH>;
        row-gpios = <&gpio1 13 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
                    <&gpio1 14 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
                    <&gpio1 15 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
    };
    // transform0: matrix_transform {
    //     compatible = "zmk,matrix-transform";
    //     columns = <1>;
    //     rows = <1>;
    //     map = <
    //         RC(0,0)
    //     >;
    // };
    transform1: matrix_transform {
        compatible = "zmk,matrix-transform";
        columns = <6>;
        rows = <3>;
        map = <
            RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)
            RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)
            RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5)
        >;
    };
};

&rtc0 {
	status = "okay";
};

// &spi0 {
// 	status = "disabled";
// };

// &spi1 {
// 	status = "disabled";
// };

// &spi2 {
// 	status = "disabled";
// };

// &spi3 {
// 	status = "disabled";
// };

&uart0 {
	status = "disabled";
};

&adc {
	status = "disabled";
};

&i2c1 {
	status = "disabled";
};

&pwm0 {
	status = "disabled";
};

&ieee802154 {
	status = "disabled";
};


// &spi2_default {
//     group1 {
//         psels = <NRF_PSEL(SPIM_SCK, 0, 21)>,
//                 <NRF_PSEL(SPIM_MOSI, 0, 20)>,
//                 <NRF_PSEL(SPIM_MISO, 0, 24)>;
//     };
// };

// &spi2_sleep {
//     group1 {
//         psels = <NRF_PSEL(SPIM_SCK, 0, 21)>,
//                 <NRF_PSEL(SPIM_MOSI, 0, 20)>,
//                 <NRF_PSEL(SPIM_MISO, 0, 24)>;
//         low-power-enable;
//     };
// };

// &spi2 {
//     status = "okay";
//     pinctrl-0 = <&spi2_default>;
//     pinctrl-1 = <&spi2_sleep>;
//     pinctrl-names = "default", "sleep";
//     cs-gpios = <&gpio0 25 GPIO_ACTIVE_LOW>;
//     p25q16h_spi: p25q16h@0 {
//         compatible = "jedec,spi-nor";
//         reg = <0>;
//         wp-gpios = <&gpio0 22 GPIO_ACTIVE_LOW>;
//         hold-gpios = <&gpio0 23 GPIO_ACTIVE_LOW>;
//         spi-max-frequency = <104000000>;
//         jedec-id = [ 85 60 15  ];
//         sfdp-bfp = [ e5 20 f1 ff ff ff ff 00 44 eb 08 6b 08 3b 80 bb ee ff ff ff ff ff 00 ff ff ff 00 ff 0c 20 0f 52 10 d8 08 81  ];
//         size = <16777216>;
//         has-dpd;
//         t-enter-dpd = <3000>;
//         t-exit-dpd = <8000>;
//     };
// };

// &qspi {
// 	status = "disabled";
// };